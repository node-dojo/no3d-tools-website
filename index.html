<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="deployment-version" content="3c1bbbe">
    <title>NO3D TOOLS</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Silka Mono font - using JetBrains Mono as alternative since Silka Mono requires license -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Visitor font - using Space Mono as closest alternative -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <!-- Marked.js for markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked@12.0.0/marked.min.js"></script>
    <!-- Three.js for 3D object viewing (low priority feature) -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <!-- Polar Embedded Checkout -->
    <!-- Using official Polar CDN - exposes window.Polar.EmbedCheckout -->
    <script src="https://cdn.jsdelivr.net/npm/@polar-sh/checkout@latest/dist/embed.global.js" defer></script>
    <script>
      // Debug: Check when Polar SDK loads
      (function() {
        function checkPolarSDK() {
          // The SDK exposes window.Polar.EmbedCheckout
          if (window.Polar && window.Polar.EmbedCheckout) {
            console.log('✅ Polar SDK loaded!', window.Polar.EmbedCheckout);
            return true;
          }

          // Log what's available for debugging
          console.log('Checking for Polar SDK...');
          console.log('window.Polar:', window.Polar);
          console.log('All window keys with "polar":', Object.keys(window).filter(k => k.toLowerCase().includes('polar')));
          return false;
        }

        // Check after script loads
        window.addEventListener('load', function() {
          if (!checkPolarSDK()) {
            // Retry a few times in case script loads after window.load
            let attempts = 0;
            const retryInterval = setInterval(() => {
              attempts++;
              if (checkPolarSDK() || attempts > 10) {
                clearInterval(retryInterval);
              }
            }, 200);
          }
        });
      })();
    </script>
    <!-- Visitor font - self-hosted WOFF2 webfont -->
    <!-- Preload Visitor font for better performance -->
    <link rel="preload" href="./fonts/visitor.woff2" as="font" type="font/woff2" crossorigin="anonymous">
    <!-- Visitor font @font-face declarations -->
    <style>
      @font-face {
        font-family: 'Visitor';
        src: url('./fonts/visitor.woff2') format('woff2');
        font-weight: 400;
        font-style: normal;
        font-display: swap;
      }
      @font-face {
        font-family: 'Visitor';
        src: url('./fonts/visitor.woff2') format('woff2');
        font-weight: 700;
        font-style: normal;
        font-display: swap;
      }
      @font-face {
        font-family: 'Visitor TT1 BRK';
        src: url('./fonts/visitor.woff2') format('woff2');
        font-weight: normal;
        font-style: normal;
        font-display: swap;
      }
    </style>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="site-container">
        <!-- Site Header -->
        <header class="site-header">
            <button class="hamburger-menu-button" id="hamburger-menu-button" aria-label="Toggle menu">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-left">
                <img src="assets/NO3D TOOLS.png" alt="NO3D TOOLS" class="logo" id="header-logo">
            </div>
            <div class="header-icons">
                <div class="cart-icon-wrapper" id="cart-icon-wrapper">
                    <img src="assets/cart icon.png" alt="Shopping Cart" class="cart-icon-image" id="cart-icon">
                    <span class="cart-badge" id="cart-badge">0</span>
                </div>
                <i class="fas fa-ellipsis-v header-icon"></i>
            </div>
        </header>

        <!-- Sidebar Backdrop (mobile only) -->
        <div class="sidebar-backdrop" id="sidebar-backdrop"></div>

        <!-- Left Sidebar Navigation -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-content" id="sidebar-content">
                <!-- 3-tier sidebar structure will be generated by JavaScript -->
            </div>
        </nav>

        <!-- Center Product Card - JSX Component Structure -->
        <main class="product-card">
            <div class="product-card-container">
                <!-- Left Section: Product Image and Details -->
                <div class="product-left-section">
                    <!-- Product Image -->
                    <div class="product-image-container">
                        <div class="product-image">
                            <img id="product-3d-image" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIwIiBoZWlnaHQ9IjI1NiIgdmlld0JveD0iMCAwIDMyMCAyNTYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMjAiIGhlaWdodD0iMjU2IiBmaWxsPSIjRThFOEU4Ii8+CjxyZWN0IHg9IjEwIiB5PSIxMCIgd2lkdGg9IjMwMCIgaGVpZ2h0PSIyMzYiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+Cjx0ZXh0IHg9IjE2MCIgeT0iMTMwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiMwMDAiIHRleHQtYW5jaG9yPSJtaWRkbGUiPk5vIDNEIEltYWdlPC90ZXh0Pgo8L3N2Zz4=" alt="DOJO MESH REPAIR 3D Render">
                        </div>
                    </div>
                    
                    <!-- Product Details -->
                    <div class="product-details">
                        <div class="product-header-row">
                            <h1 class="product-title" id="product-title">DOJO MESH REPAIR</h1>
                            <div class="product-price" id="product-price">PRICE: $7.99</div>
                        </div>
                        <button class="download-button" id="download-button" style="display: none;">DOWNLOAD</button>
                        <button class="buy-now-button" id="buy-now-button">BUY NOW</button>
                    </div>
                </div>

                <!-- Right Section: Tabs, Description, Changelog -->
                <div class="product-right-section">
                    <!-- Tab Navigation -->
                    <div class="product-tabs">
                        <div class="tab-container">
                            <div class="tab-icon expanded" data-tab="description">
                                <div class="tab-arrow">▼</div>
                            </div>
                            <div class="tab active" data-tab="description">DESCRIPTION</div>
                        </div>
                        <div class="tab-container">
                            <div class="tab-icon collapsed" data-tab="docs">
                                <div class="tab-arrow">▶</div>
                            </div>
                            <div class="tab" data-tab="docs">DOCS</div>
                        </div>
                    </div>

                    <!-- Product Description -->
                    <div class="product-description" id="product-description">
                        <p>Professional mesh repair and optimization tool designed for 3D artists and engineers. Dojo Mesh Repair automatically detects and fixes common mesh issues including holes, non-manifold edges, overlapping faces, and inverted normals.</p>
                        <p>&nbsp;</p>
                        <p>With its intelligent algorithms, the tool preserves the original geometry while ensuring watertight meshes suitable for 3D printing, rendering, and simulation. Save hours of manual cleanup with automated repair processes that maintain the artistic integrity of your models.</p>
                    </div>

                    <!-- Changelog Section -->
                    <div class="changelog-section">
                        <div class="changelog-header">
                            <div class="changelog-icon expanded">
                                <div class="changelog-arrow">▼</div>
                            </div>
                            <span class="changelog-title" id="changelog-title">CHANGELOG</span>
                        </div>
                        <div class="changelog-content">
                            <ul id="changelog-list">
                                <!-- Changelog items will be populated from product JSON data -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Horizontal Scrolling Icon Grid (Tools Section Only) -->
        <div class="horizontal-icon-grid-container" id="horizontal-icon-grid-container">
            <div class="horizontal-icon-grid" id="horizontal-icon-grid">
                <!-- Icons will be populated by JavaScript when Tools section is active -->
            </div>
        </div>

        <!-- Right Icon Grid -->
        <!-- Icons are dynamically generated from GitHub repository -->
        <aside class="icon-grid">
            <!-- Icon items will be populated by JavaScript from no3d-tools-library repository -->
        </aside>
    </div>

    <!-- Mobile Search Bar (bottom of screen, mobile only) -->
    <div class="mobile-search-bar" id="mobile-search-bar">
        <input type="text" class="mobile-search-input" id="mobile-search-input" placeholder="SEARCH TOOLS..." aria-label="Search tools">
        <button class="mobile-search-button" id="mobile-search-button" aria-label="Search">
            <i class="fas fa-search"></i>
        </button>
    </div>

    <footer class="footer">
        <span class="footer-text" id="footer-text">Cmd/ctrl + K to Search</span>
        <img src="assets/stone logo.png" alt="Stone Logo" class="footer-logo">
    </footer>

    <!-- Command Palette Search Modal -->
    <div class="search-modal-backdrop" id="search-modal-backdrop"></div>
    <div class="search-modal" id="search-modal">
        <div class="search-modal-container">
            <div class="search-modal-header">
                <input 
                    type="text" 
                    class="search-input" 
                    id="search-input" 
                    placeholder="Search products, descriptions, categories..."
                    autocomplete="off"
                >
            </div>
            <div class="search-results-container" id="search-results-container">
                <div class="search-results-empty" id="search-results-empty">
                    <span>No results found</span>
                </div>
            </div>
            <div class="search-modal-footer">
                <span class="search-hint">
                    <span class="search-key">↑↓</span> Navigate
                    <span class="search-key">↵</span> Select
                    <span class="search-key">Esc</span> Close
                </span>
            </div>
        </div>
    </div>

    <!-- Shopping Cart Modal -->
    <div class="cart-modal-backdrop" id="cart-modal-backdrop"></div>
    <div class="cart-modal" id="cart-modal">
        <div class="cart-modal-container">
            <div class="cart-modal-header">
                <h2 class="cart-title">SHOPPING CART</h2>
                <button class="cart-close-button" id="cart-close-button" aria-label="Close cart">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="cart-items-container" id="cart-items-container">
                <div class="cart-empty" id="cart-empty">
                    <span class="cart-empty-text">Your cart is empty</span>
                    <span class="cart-empty-hint">Add products to your cart to get started</span>
                </div>
            </div>
            <div class="cart-modal-footer" id="cart-footer">
                <div class="cart-total-container">
                    <span class="cart-total-label">TOTAL:</span>
                    <span class="cart-total-amount" id="cart-total-amount">$0.00</span>
                </div>
                <div class="cart-action-buttons">
                    <button class="cart-continue-shopping-button" id="cart-continue-shopping-button">
                        CONTINUE SHOPPING
                    </button>
                    <button class="cart-checkout-button" id="cart-checkout-button" disabled>
                        CHECK OUT
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div class="checkout-modal-backdrop" id="checkout-modal-backdrop"></div>
    <div class="checkout-modal" id="checkout-modal">
        <div class="checkout-modal-container">
            <div class="checkout-modal-header">
                <h2 class="checkout-title">CHECKOUT</h2>
                <button class="checkout-close-button" id="checkout-close-button" aria-label="Close checkout">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="checkout-content-container" id="checkout-content-container">
                <div class="checkout-loading" id="checkout-loading">
                    <span class="checkout-loading-text">Loading checkout...</span>
                </div>
                <div class="checkout-error" id="checkout-error" style="display: none;">
                    <span class="checkout-error-text">Unable to load checkout modal. Redirecting to checkout page...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Vercel Analytics -->
    <script defer src="https://cdn.vercel-insights.com/script.js"></script>
    <script src="polar-products.js"></script>
    <script type="module" src="script.js"></script>
</body>
</html>
