<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Viewer Comparison - NO3D TOOLS</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- model-viewer -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r160/three.min.js"></script>

    <style>
        body {
            background-color: #E8E8E8;
            font-family: 'Courier New', monospace;
        }

        .viewer-container {
            width: 100%;
            height: 500px;
            background-color: #E8E8E8;
            border: 2px solid #000;
            position: relative;
        }

        model-viewer {
            width: 100%;
            height: 100%;
            background-color: #E8E8E8;
        }

        .section {
            margin-bottom: 3rem;
        }

        .controls {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #000;
            color: #E8E8E8;
        }

        .info {
            padding: 0.5rem;
            background-color: #fff;
            border: 1px solid #000;
            margin-top: 0.5rem;
            font-size: 12px;
        }

        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .pros {
            padding: 1rem;
            background-color: #d4edda;
            border: 1px solid #000;
        }

        .cons {
            padding: 1rem;
            background-color: #f8d7da;
            border: 1px solid #000;
        }
    </style>
</head>
<body class="p-8">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-4xl font-bold mb-2">3D VIEWER COMPARISON</h1>
        <p class="mb-8">Testing three different approaches for 3D model viewing</p>

        <!-- File Selector -->
        <div class="mb-8 p-4 bg-black text-white">
            <h2 class="text-xl mb-4">SELECT TEST FILE:</h2>
            <input type="file" id="file-input" accept=".stl,.glb,.gltf,.usdz" class="w-full p-2 bg-gray-800 text-white">
            <div class="mt-4 grid grid-cols-3 gap-2">
                <button onclick="loadSample('Vert_015_20250902_192454.stl')" class="p-2 bg-gray-700 hover:bg-gray-600">
                    Small STL (76KB)
                </button>
                <button onclick="loadSample('Cube_005_20250808_140127.stl')" class="p-2 bg-gray-700 hover:bg-gray-600">
                    Medium STL (1.2MB)
                </button>
                <button onclick="loadSample('loose_snake_lighter_20251112_225345.stl')" class="p-2 bg-gray-700 hover:bg-gray-600">
                    Large STL (3.8MB)
                </button>
            </div>
        </div>

        <!-- Option 1: model-viewer (Google) -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">1. MODEL-VIEWER (Google Web Component)</h2>

            <div class="viewer-container">
                <model-viewer
                    id="model-viewer-1"
                    camera-controls
                    auto-rotate
                    shadow-intensity="1"
                    ar
                    ar-modes="webxr scene-viewer quick-look"
                    environment-image="neutral">
                    <div slot="progress-bar" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                        Loading...
                    </div>
                </model-viewer>
            </div>

            <div class="controls">
                <div id="mv-status">Status: Ready</div>
                <div id="mv-info" class="info mt-2"></div>
            </div>

            <div class="pros-cons">
                <div class="pros">
                    <h3 class="font-bold mb-2">‚úÖ PROS:</h3>
                    <ul class="list-disc list-inside text-sm">
                        <li>Official Google solution</li>
                        <li>AR support built-in</li>
                        <li>Automatic lighting</li>
                        <li>Very simple to use</li>
                        <li>Handles GLB/GLTF natively</li>
                        <li>Mobile-optimized</li>
                    </ul>
                </div>
                <div class="cons">
                    <h3 class="font-bold mb-2">‚ùå CONS:</h3>
                    <ul class="list-disc list-inside text-sm">
                        <li>No STL support (needs conversion)</li>
                        <li>Less customization control</li>
                        <li>Larger bundle size</li>
                        <li>Limited to their API</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Option 2: Three.js with STLLoader -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">2. CUSTOM THREE.JS VIEWER (Our Build)</h2>

            <div class="viewer-container" id="threejs-container">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #000;">
                    Loading viewer...
                </div>
            </div>

            <div class="controls">
                <div id="threejs-status">Status: Initializing...</div>
                <div id="threejs-info" class="info mt-2"></div>
                <button onclick="toggleRotation()" class="mt-2 px-4 py-2 bg-gray-700 text-white">Toggle Rotation</button>
            </div>

            <div class="pros-cons">
                <div class="pros">
                    <h3 class="font-bold mb-2">‚úÖ PROS:</h3>
                    <ul class="list-disc list-inside text-sm">
                        <li>Full control over rendering</li>
                        <li>STL support out of the box</li>
                        <li>Lightweight (only what we need)</li>
                        <li>Can customize everything</li>
                        <li>Direct Three.js access</li>
                        <li>No external dependencies</li>
                    </ul>
                </div>
                <div class="cons">
                    <h3 class="font-bold mb-2">‚ùå CONS:</h3>
                    <ul class="list-disc list-inside text-sm">
                        <li>More code to maintain</li>
                        <li>Need to handle edge cases</li>
                        <li>No AR support built-in</li>
                        <li>We build all features ourselves</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Option 3: Three.js Editor Iframe Embed -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">3. THREE.JS EDITOR (Iframe Embed)</h2>

            <div class="viewer-container">
                <iframe
                    id="threejs-editor"
                    src="about:blank"
                    style="width: 100%; height: 100%; border: none;">
                </iframe>
            </div>

            <div class="controls">
                <div id="editor-status">Status: Not implemented (demo only)</div>
                <div id="editor-info" class="info mt-2">
                    Three.js Editor requires hosting the editor separately and is better suited for full editing, not just viewing.
                </div>
            </div>

            <div class="pros-cons">
                <div class="pros">
                    <h3 class="font-bold mb-2">‚úÖ PROS:</h3>
                    <ul class="list-disc list-inside text-sm">
                        <li>Full Three.js editor UI</li>
                        <li>All Three.js features</li>
                        <li>Can save/export scenes</li>
                        <li>Material editor included</li>
                    </ul>
                </div>
                <div class="cons">
                    <h3 class="font-bold mb-2">‚ùå CONS:</h3>
                    <ul class="list-disc list-inside text-sm">
                        <li>Heavy (entire editor app)</li>
                        <li>Overkill for just viewing</li>
                        <li>Complex to embed</li>
                        <li>Not ideal for production</li>
                        <li>Requires separate hosting</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Recommendation -->
        <div class="mt-8 p-6 bg-yellow-100 border-2 border-black">
            <h2 class="text-2xl font-bold mb-4">üí° RECOMMENDATION:</h2>
            <div class="space-y-2">
                <p><strong>For STL files + customization:</strong> Use Option 2 (Custom Three.js)</p>
                <p><strong>For GLB/GLTF + ease of use:</strong> Use Option 1 (model-viewer)</p>
                <p><strong>For full editing features:</strong> Use Option 3 (Three.js Editor) - but only if needed</p>
            </div>
        </div>
    </div>

    <script type="module">
        // Import our custom viewer
        import { AssetViewer } from './viewer-component.js';

        let customViewer = null;
        let currentFile = null;

        // Initialize custom Three.js viewer
        async function initCustomViewer() {
            const container = document.getElementById('threejs-container');

            try {
                customViewer = new AssetViewer(container, {
                    autoRotate: true,
                    autoRotateSpeed: 1.0,
                    backgroundColor: '#E8E8E8'
                });

                await customViewer.init();

                // Remove loading message
                container.innerHTML = '';

                document.getElementById('threejs-status').textContent = 'Status: Ready';
                console.log('‚úÖ Custom viewer initialized');
            } catch (error) {
                console.error('‚ùå Failed to initialize custom viewer:', error);
                document.getElementById('threejs-status').textContent = 'Status: Error - ' + error.message;
            }
        }

        // Load file into viewers
        async function loadFileIntoViewers(file) {
            currentFile = file;
            const url = URL.createObjectURL(file);
            const format = file.name.split('.').pop().toLowerCase();

            console.log(`Loading ${format} file:`, file.name);

            // Update info
            const fileInfo = `File: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;
            document.getElementById('mv-info').textContent = fileInfo;
            document.getElementById('threejs-info').textContent = fileInfo;

            // Load into model-viewer (only GLB/GLTF)
            const modelViewer = document.getElementById('model-viewer-1');
            if (format === 'glb' || format === 'gltf') {
                modelViewer.src = url;
                document.getElementById('mv-status').textContent = 'Status: Loading...';

                modelViewer.addEventListener('load', () => {
                    document.getElementById('mv-status').textContent = 'Status: Loaded ‚úÖ';
                }, { once: true });

                modelViewer.addEventListener('error', (e) => {
                    document.getElementById('mv-status').textContent = 'Status: Error ‚ùå';
                    console.error('model-viewer error:', e);
                }, { once: true });
            } else {
                document.getElementById('mv-status').textContent = 'Status: Unsupported format (needs GLB/GLTF)';
            }

            // Load into custom viewer
            if (customViewer) {
                try {
                    document.getElementById('threejs-status').textContent = 'Status: Loading...';
                    await customViewer.loadModel(url, format);
                    document.getElementById('threejs-status').textContent = 'Status: Loaded ‚úÖ';
                } catch (error) {
                    document.getElementById('threejs-status').textContent = 'Status: Error - ' + error.message;
                    console.error('Custom viewer error:', error);
                }
            }
        }

        // File input handler
        document.getElementById('file-input').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) loadFileIntoViewers(file);
        });

        // Sample loader
        window.loadSample = async function(filename) {
            const url = `test-assets/${filename}`;

            try {
                const response = await fetch(url);
                const blob = await response.blob();
                const file = new File([blob], filename, { type: blob.type });
                loadFileIntoViewers(file);
            } catch (error) {
                console.error('Failed to load sample:', error);
                alert('Failed to load sample file. Make sure the test-assets folder contains: ' + filename);
            }
        };

        // Toggle rotation for custom viewer
        window.toggleRotation = function() {
            if (customViewer) {
                customViewer.toggleAutoRotate();
            }
        };

        // Initialize on load
        initCustomViewer();
    </script>
</body>
</html>
